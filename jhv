def feedback_agent_node(state: WorkflowState) -> WorkflowState:
    logging.info("Calling FeedbackAgent")
    user_feedback = state.get("issue_text", "rating")
    issue_text = user_feedback.get("issue_text")
    rating = user_feedback.get("rating", 1)
    if not issue_text:
        # fallback to validation errors if user feedback missing
        issue_text = str(state.get("validation_result", {}).get("errors", ""))
        if not issue_text or issue_text == "[]":
            issue_text = state.get("validation_result", {}).get("reason", "Unknown error")
        if not issue_text:
            issue_text = "Validation failed, but no error details were provided."

    payload = {
        "username": state["username"],
        "issue_text": issue_text,
        "rating": rating,
        "mobile": state.get("mobile", "")
    }
